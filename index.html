<template>
	<view class="page-container safe-area-inset-bottom-bg" style="background-color: transparent;">
		<!-- 背景使用更简洁的设计 -->
		<view class="ios-background">
			<view class="ios-gradient-bg"></view>
		</view>
		
		<!-- 状态栏 -->
		<view class="ios-status-bar"></view>
		
		<!-- 页面内容区域 - 使用iOS风格的滚动视图 -->
		<scroll-view 
			scroll-y="true" 
			class="ios-scroll-container" 
			@scroll="handleScroll"
			:scroll-with-animation="false"
			:enhanced="true"
			:bounces="true"
			:show-scrollbar="false"
			@scrolltolower="handleScrollToLower"
			:lower-threshold="150"
			:enable-flex="true"
			:enable-back-to-top="true"
			:fast-deceleration="true"
			:scroll-anchoring="true"
			:enable-passive="true">
			
			<!-- 顶部导航区域 -->
			<view class="ios-nav-header">
				<view class="ios-header-left">
				</view>
			</view>
			
			<!-- 词汇展示区 - iOS卡片风格 -->
			<swiper 
				class="ios-word-swiper" 
				:indicator-dots="false" 
				:autoplay="false" 
				:circular="true"
				@change="handleSwiperChange"
				:previous-margin="'50rpx'"
				:next-margin="'50rpx'"
				:duration="300"
				:easing-function="'easeOutCubic'"
			>
				<swiper-item v-if="isLoading">
					<view class="ios-card ios-loading-card">
						<view class="ios-loading-indicator"></view>
						<text class="ios-loading-text">加载中...</text>
					</view>
				</swiper-item>
				
				<swiper-item v-for="(item, index) in displayWords" :key="index" v-else>
					<view class="ios-card" 
						  :class="{'ios-card-active': currentWordIndex === index}"
						  @click="playAudio">
						<view class="ios-card-content"
							:class="{'mongolian-card-content': currentLanguage === 'mongolian' || currentLanguage === 'manchu'}">
							<view class="ios-card-header">
								<text
									:class="{
										'ios-word-character': true,
										'vertical-mongolian': currentLanguage === 'mongolian' || currentLanguage === 'manchu',
										'ios-word-long': item.word && item.word.length > 8,
										'ios-word-very-long': item.word && item.word.length > 15
									}"
									:data-language="currentLanguage"
									:style="wordCharacterStyle">
									{{ item.word || '单词' }}
								</text>
							</view>
							<view
								v-if="currentLanguage === 'mongolian' || currentLanguage === 'manchu'"
								class="vertical-mongolian-pinyin"
							>
								{{ (item.pinyin || '').replace(/ /g, '　') }}
							</view>
							<view v-else class="ios-word-pinyin-box">
								<text class="ios-word-pinyin">{{ item.pinyin || '' }}</text>
							</view>
							<view class="ios-word-meaning-box"
								:class="{'vertical-mongolian': currentLanguage === 'mongolian' || currentLanguage === 'manchu'}">
								<text
									:class="{
										'ios-word-meaning': true,
										'vertical-mongolian-chinese': currentLanguage === 'mongolian' || currentLanguage === 'manchu'
									}"
								>
									{{ truncateText(item.meaning || '单词释义和例句将显示在这里') }}
								</text>
							</view>
							<!-- 详细按钮放在释义下方 -->
							<view class="detail-btn-container"
								@tap.stop="goToWordDetail(item)"
								:class="{'vertical-mongolian': currentLanguage === 'mongolian' || currentLanguage === 'manchu'}">
								<view class="detail-btn"
									:class="{'vertical-mongolian': currentLanguage === 'mongolian' || currentLanguage === 'manchu'}">
									<text class="detail-text">详细</text>
								</view>
							</view>
						</view>
					</view>
				</swiper-item>
			</swiper>

			<!-- 快捷菜单 - iOS风格网格 -->
			<view class="ios-menu-section">
				<view class="ios-section-header">
					<text class="ios-section-title">快捷功能</text>
				</view>
				
				<view class="ios-grid">
					<view 
						v-for="(item, index) in menuItemsWithCharIcon" 
						:key="index"
						class="ios-grid-item"
						@click="tn(item.route)"
						:style="{'--index': index}"
					>
						<view class="ios-grid-icon-container">
							<image class="ios-grid-icon" :src="item.icon"></image>
						</view>
						<text class="ios-grid-label">{{ item.text }}</text>
					</view>
				</view>
			</view>
			
			<!-- 文章阅读区域 -->
			<view class="article-section">
				<view class="section-header">
					<text class="section-title">文章阅读</text>
				</view>
				
				<view class="article-list">
					<view class="search-bar">
						<view class="search-input">
							<view class="search-icon">
								<image src="/static/chuangguang/search-circle-svgrepo-com.svg" mode="aspectFit"></image>
							</view>
							<input type="text" placeholder="搜索文章" v-model="searchText" @input="handleSearch" />
							<view class="search-clear" v-if="searchText" @click="clearSearch"></view>
						</view>
					</view>
					
					<view v-if="isLoading" class="loading-state">
						<view class="loading-spinner"></view>
						<text>加载中...</text>
					</view>
					
					<view v-else-if="filteredArticles.length === 0" class="no-results">
						<view class="no-results-icon"></view>
						<text>暂无相关文章</text>
					</view>
					
					<view v-else>
						<view 
							v-for="(article, index) in filteredArticles" 
							:key="article.id"
							class="article-item"
							@click="goToArticle(article.id)">
							
							<view class="article-avatar">
								<text>{{article.title.substring(0, 1)}}</text>
							</view>
							
							<view class="article-content">
								<text class="article-title">{{article.title}}</text>
								<text class="article-description">{{article.description}}</text>
								<view class="article-footer">
									<text class="article-author">{{article.author}}</text>
									<text class="article-date">{{article.date}}</text>
								</view>
							</view>
						</view>
					</view>
				</view>
			</view>
			
			<!-- 底部加载区域 -->
			<view class="ios-load-more" v-if="hasMoreData">
				<view class="ios-loading-dots" v-if="isPulling">
					<view class="ios-loading-dot"></view>
					<view class="ios-loading-dot"></view>
					<view class="ios-loading-dot"></view>
				</view>
				<text class="ios-load-text">{{ isPulling ? '加载中...' : '上拉加载更多' }}</text>
			</view>
			
			<view class="ios-no-more-data" v-else>
				<text>— 已经到底了 —</text>
			</view>
			
			<!-- 底部安全区域 -->
			<view class="ios-safe-area-bottom"></view>
		</scroll-view>

		<!-- 返回顶部按钮 - iOS风格 -->
		<view class="ios-back-to-top" :class="{'ios-visible': showBackToTop}" @click="scrollToTop">
			<view class="ios-back-to-top-icon"></view>
		</view>
	</view>
</template>

<script>
	import template_page_mixin from '@/libs/mixin/template_page_mixin.js'
	import NavIndexButton from '@/libs/components/nav-index-button.vue'
	import dynamicDemoTemplate from '@/libs/components/dynamic-demo-template.vue'
	import tool from '@/utils/common.js';
	// import {
	// 	getDictByCode
	// } from '@/apis/dict';
	export default {
		name: 'TemplateCourse',
		mixins: [template_page_mixin],
		components: {
			NavIndexButton,
			dynamicDemoTemplate
		},
		data() {
			return {
				tips: ['每天一测', '掌握最新成绩'],
				isPlaying: false,
				currentWordIndex: 0,
				
				// 示例单词数据
				displayWords: [],
				allWords: [], // 存储所有单词
				pageSize: 20, // 每页显示的单词数
				currentPage: 0, // 当前页码
				isLoadingMore: false, // 是否正在加载更多
				audioContext: null,
				currentAudio: null,
				isLoading: true,
				vocabUrl: '',
				currentLanguage: uni.getStorageSync('currentLanguage') || 'nushu', // 初始化时从存储中获取语言设置
				
				// 菜单项
				menuItems: [
					{
						text: '语言',
						icon: '../../static/chuangguang/language-svgrepo-com.svg',
						route: '/pages/index/language'
					},
					{
						text: '字典',
						icon: '../../static/icon/dictionary-2-svgrepo-com.svg',
						route: '/pages/dict/search'
					},
					{
						text: '翻译',
						icon: '../../static/icon/translate-svgrepo-com (1).svg',
						route: '/pages/translate/index'
					},
					{
						text: '音乐',
						icon: '../../static/icon/sound-svgrepo-com.svg',
						route: '/pages/song/list'
					},
					{
						text: '字符',
						icon: '', // 用computed动态赋值
						route: '/pages/memo/index'
					},
					{
						text: '输入',
						icon: '../../static/icon/keyboard-shortcuts-svgrepo-com.svg',
						route: '/pages/enter/index'
					},
					{
						text: '更多',
						icon: '../../static/icon/more-filled-svgrepo-com.svg',
						route: '/pages/level/list'
					}
				],
				
				articles: [], // 替换本地文章数据为空数组
				scrolled: false,
				showBackToTop: false,
				scrollTop: 0,
				lastScrollTime: 0,
				scrollThrottling: false,
				scrollTimeout: null,
				animatedItems: [],
				isScrolling: false,
				isSmallScreen: false,
				isPulling: false,
				pullLoading: false,
				hasMoreData: true,
				elasticPulling: false,
				maxElasticDistance: 0,
				touchStartY: 0,
				elasticHeight: 0,
				touchMoveY: 0,
				initialScrollTop: 0,
				maxOverScroll: 150,
				isElasticAnimating: false,
				isLoggedIn: false,
				userInfo: {},
				useReducedMotion: false,
				scrollTimeoutId: null,
				currentFont: 'Nushu', // 默认字体
				userId: '', // 添加用户ID字段
				searchText: '',
				selectedCategory: 'all',
				categories: [
					{ id: 'all', name: '全部' },
					{ id: 'history', name: '历史文化' },
					{ id: 'language', name: '语言研究' },
					{ id: 'modern', name: '现代传承' },
					{ id: 'society', name: '社会影响' }
				],
			}
		},
		computed: {
			currentLanguageIcon() {
				return '../../static/chuangguang/language-svgrepo-com.svg';
			},
			wordCharacterStyle() {
				return {
					fontFamily: this.currentLanguage === 'nushu' ? 'Nushu' : 
								this.currentLanguage === 'hannom' ? 'Hannom' : 
								this.currentLanguage === 'yiwen' ? 'Yiwen' : 
								this.currentLanguage === 'mongolian' ? 'Mengguwen' :
								this.currentLanguage === 'manchu' ? 'system-ui' : 'Diannanguyiwen'
				}
			},
			charIcon() {
				if (this.currentLanguage === 'hannom') {
					return '../../static/chuangguang/hannom logo.svg';
				} else if (this.currentLanguage === 'yiwen') {
					return '../../static/chuangguang/yiwen.svg';
				} else if (this.currentLanguage === 'diannanguyiwen') {
					return '../../static/chuangguang/diannanyiwen.svg';
				} else if (this.currentLanguage === 'mongolian') {
					return '../../static/chuangguang/mengguwen.svg';
				} else if (this.currentLanguage === 'manchu') {
					return '../../static/chuangguang/manchu.svg';
				} else {
					return '../../static/icon/nvshu.svg';
				}
			},
			menuItemsWithCharIcon() {
				// 返回一个新的 menuItems，字符按钮的icon动态赋值
				return this.menuItems.map(item => {
					if (item.text === '字符') {
						return { ...item, icon: this.charIcon };
					}
					return item;
				});
			},
			filteredArticles() {
				let result = this.articles;
				
				// 根据分类筛选
				if (this.selectedCategory !== 'all') {
					result = result.filter(article => article.categoryId === this.selectedCategory);
				}
				
				// 根据搜索关键词筛选
				if (this.searchText) {
					const keyword = this.searchText.toLowerCase();
					result = result.filter(article => 
						article.title.toLowerCase().includes(keyword) || 
						article.description.toLowerCase().includes(keyword) ||
						article.author.toLowerCase().includes(keyword)
					);
				}
				
				return result;
			}
		},
		watch: {
			currentLanguage: {
				immediate: true,
				handler(newLang) {
					// 根据语言设置字体
					this.currentFont = newLang === 'nushu' ? 'Nushu' : newLang === 'hannom' ? 'Hannom' : newLang === 'yiwen' ? 'Yiwen' : 'Diannanguyiwen';
					// 更新词汇URL
					this.updateVocabUrl();
					// 重新获取文章数据
					this.fetchArticles();
				}
			}
		},
		onReady() {
			// 移除弹幕初始化
		},
		onLoad() {
			// 获取用户ID和语言设置
			const userInfo = uni.getStorageSync('userInfo');
			if (userInfo && userInfo.id) {
				this.userId = userInfo.id;
				// 从服务器获取语言设置
				this.getLanguagePreference();
			} else {
				// 如果未登录，从本地存储获取当前语言设置
				const savedLanguage = uni.getStorageSync('currentLanguage');
				if (savedLanguage) {
					this.currentLanguage = savedLanguage;
				}
				// 确保初始化词汇URL
				this.updateVocabUrl();
			}
			
			// 监听语言变化
			uni.$on('languageChanged', this.handleLanguageChange);
			
			// 创建音频上下文
			this.audioContext = uni.createInnerAudioContext();
			this.audioContext.onEnded(() => {
				this.isPlaying = false;
			});
			this.audioContext.onPlay(() => {
				this.isPlaying = true;
			});
			this.audioContext.onError(() => {
				this.isPlaying = false;
				uni.showToast({
					title: '音频播放失败',
					icon: 'none'
				});
			});
			
			// 获取词汇数据
			this.fetchVocabData();
			
			// 获取文章数据
			this.fetchArticles();
			
			// 预加载字体
			this.preloadFont();
			
			// 获取系统信息，判断小屏幕设备
			try {
				const sysInfo = uni.getSystemInfoSync();
				// 判断是否为小屏幕设备 (高度小于600px左右的设备)
				if (sysInfo.windowHeight < 600) {
					this.isSmallScreen = true;
					// 小屏幕设备特殊处理
					this.adjustForSmallScreen();
				}
				
				// 检测是否需要减少动画
				if (sysInfo.platform === 'android' && sysInfo.system && parseInt(sysInfo.system) < 8) {
					this.useReducedMotion = true;
				}
				
				// 如果是低内存设备，也减少动画
				if (sysInfo.benchmarkLevel < 30) {
					this.useReducedMotion = true;
				}
			} catch (e) {
				// 错误处理
			}
			
			// 针对性能优化进行初始化
			this.initPerformanceOptimizations();
		},
		onUnload() {
			// 清理音频资源
			if (this.audioContext) {
				this.audioContext.destroy();
			}
			
			// 清理计时器
			clearTimeout(this.scrollEndTimeout);
			
			// 清理模拟RAF
			if (this.scrollTimeoutId) {
				this.clearSimulateRAF(this.scrollTimeoutId);
			}
			
			// 移除语言变化监听
			uni.$off('languageChanged', this.handleLanguageChange);
		},
		onShow() {
			// 检查并更新登录状态
			const userInfo = uni.getStorageSync('userInfo');
			if (userInfo && userInfo.id) {
				this.isLoggedIn = true;
				this.userInfo = userInfo;
			} else {
				this.isLoggedIn = false;
			}
			
			// 检查语言是否改变
			const savedLanguage = uni.getStorageSync('currentLanguage');
			if (savedLanguage && savedLanguage !== this.currentLanguage) {
				this.handleLanguageChange(savedLanguage);
			}
		},
		methods: {
			// 获取语言偏好设置
			async getLanguagePreference() {
				if (!this.userId) return;
				
				try {
					const result = await uniCloud.callFunction({
						name: 'userService',
						data: {
							action: 'getLanguagePreference',
							userId: this.userId
						}
					});
					
					if (result.result && result.result.code === 0) {
						const language = result.result.data.languagePreference;
						
						if (language) {
							this.currentLanguage = language;
							// 保存到本地存储
							uni.setStorageSync('currentLanguage', language);
							// 强制更新字体和词汇URL
							this.currentFont = language === 'nushu' ? 'Nushu' : language === 'hannom' ? 'Hannom' : language === 'yiwen' ? 'Yiwen' : 'Diannanguyiwen';
							this.updateVocabUrl();
							// 重新获取词汇数据
							this.fetchVocabData();
						}
					}
				} catch (error) {
					// 如果获取失败，使用本地存储的语言设置
					const savedLanguage = uni.getStorageSync('currentLanguage');
					if (savedLanguage) {
						this.currentLanguage = savedLanguage;
						this.updateVocabUrl();
						this.fetchVocabData();
					}
				}
			},
			// 处理滑动切换事件
			handleSwiperChange(e) {
				this.currentWordIndex = e.detail.current;
				// 预加载下一个单词
				this.preloadNextWord();
				
				// 当滑动到倒数第三个单词时，加载更多
				if (this.currentWordIndex >= this.displayWords.length - 3) {
					this.loadNextPage();
				}
			},
			
			// 获取女书词汇数据
			fetchVocabData() {
				if (!this.vocabUrl) {
					console.log('No vocab URL available');
					return;
				}
				
				console.log('Fetching vocab data for language:', this.currentLanguage);
				this.isLoading = true;
				
				// 重置数据
				this.displayWords = [];
				this.allWords = [];
				this.currentPage = 0;
				this.currentWordIndex = 0;
				
				uni.request({
					url: this.vocabUrl,
					success: (res) => {
						console.log('Vocab data received:', res.statusCode);
						if (res.statusCode === 200 && res.data && Array.isArray(res.data)) {
							// 每次获取数据时都重新打乱
							const shuffledData = this.shuffleArray([...res.data]);
							
							// 存储所有单词数据
							if (this.currentLanguage === 'manchu') {
								this.allWords = shuffledData.map(item => ({
									word: item.manchu || '',
									pinyin: item.transcription || '',
									meaning: item['Definition 1'] || '',
									partOfSpeech: item['Part of Speech'] || '',
									fullData: { ...item }
								}));
							} else if (this.currentLanguage === 'mongolian') {
								this.allWords = shuffledData.map(item => ({
									word: item.蒙古文 || '',
									pinyin: item.转写 || '',
									meaning: item.释义1 || '',
									audio: '',
									fullData: { ...item }
								}));
							} else if (this.currentLanguage === 'nushu') {
								this.allWords = shuffledData.map(item => ({
									word: item.wordData || '',
									pinyin: item.phonetic || '',
									meaning: item.dialect || '',
									audio: '',
									fullData: { ...item }
								}));
							} else if (this.currentLanguage === 'yiwen') {
								this.allWords = shuffledData.map(item => ({
									word: item.wordData || '',
									pinyin: item.phonetic || '',
									meaning: item.dialect || '',
									audio: '',
									fullData: { ...item }
								}));
							} else if (this.currentLanguage === 'diannanguyiwen') {
								this.allWords = shuffledData.map(item => ({
									word: item.wordData || '',
									pinyin: item.phonetic || '',
									meaning: item.mandarin || '',
									audio: '',
									fullData: { ...item }
								}));
							} else if (this.currentLanguage === 'hannom') {
								this.allWords = shuffledData.map(item => ({
									word: item.character || '',
									pinyin: item.pinyin || '',
									meaning: item.meaning || '',
									audio: '',
									fullData: { ...item }
								}));
							}
							
							// 加载第一页数据
							this.loadNextPage();
						} else {
							console.log('Invalid vocab data received');
							this.loadFallbackData();
						}
					},
					fail: (err) => {
						console.error('Failed to fetch vocab data:', err);
						this.loadFallbackData();
					},
					complete: () => {
						this.isLoading = false;
					}
				});
			},
			
			// 加载下一页数据
			loadNextPage() {
				if (this.isLoadingMore) return;
				
				this.isLoadingMore = true;
				
				const start = this.currentPage * this.pageSize;
				const end = start + this.pageSize;
				const newWords = this.allWords.slice(start, end);
				
				if (newWords.length > 0) {
					this.displayWords = [...this.displayWords, ...newWords];
					this.currentPage++;
				}
				
				this.isLoadingMore = false;
			},
			
			// 添加预加载方法
			preloadNextWord() {
				const nextIndex = (this.currentWordIndex + 1) % this.displayWords.length;
				const nextWord = this.displayWords[nextIndex];
				if (nextWord) {
					// 预加载下一个单词的字体
					this.preloadWordFont(nextWord.word);
				}
			},
			
			// 优化字体预加载
			preloadWordFont(word) {
				if (!word) return;
				// #ifdef H5
				setTimeout(() => {
					const tempElement = document.createElement('div');
					tempElement.style.fontFamily = this.currentFont;
					tempElement.style.position = 'absolute';
					tempElement.style.visibility = 'hidden';
					tempElement.textContent = word;
					document.body.appendChild(tempElement);
					// 强制重排以触发字体加载
					tempElement.offsetHeight;
					// 清理临时元素
					document.body.removeChild(tempElement);
				}, 0);
				// #endif
			},
			
			// 优化数组随机打乱方法
			shuffleArray(array) {
				const result = [...array];
				for (let i = result.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[result[i], result[j]] = [result[j], result[i]];
				}
				return result;
			},
			
			// 播放音频
			playAudio() {
				if (this.isPlaying) {
					this.audioContext.stop();
					this.isPlaying = false;
					return;
				}
				
				const currentWord = this.displayWords[this.currentWordIndex];
				if (!currentWord || !currentWord.audio) {
					uni.showToast({
						title: '无音频数据',
						icon: 'none'
					});
					return;
				}
				
				try {
					this.audioContext.src = currentWord.audio;
					this.audioContext.play();
				} catch (e) {
					uni.showToast({
						title: '播放音频出错',
						icon: 'none'
					});
					this.isPlaying = false;
				}
			},
			
			// 页面跳转
			tn(url) {
				if (!url) return;
				
				if (url === '/pages/index/language') {
					// 特殊处理语言切换页面
					uni.navigateTo({
						url: url,
						events: {
								languageChanged: (language) => {
									this.handleLanguageChange(language);
								}
							}
					});
				} else {
					uni.navigateTo({
						url: url,
						fail: (err) => {
							console.error("页面跳转失败:", err);
							uni.showToast({
								title: '页面跳转失败',
								icon: 'none'
							});
						}
					});
				}
			},
			
			// 预加载字体
			preloadFont() {
				const fontPath = this.currentLanguage === 'nushu' 
					? '../../static/fonts/Nushu.ttf'
					: this.currentLanguage === 'hannom'
					? '../../static/fonts/NOMNATONG-REGULAR.TTF'
					: this.currentLanguage === 'yiwen'
					? '../../static/fonts/Yiwen.ttf'
					: '../../static/fonts/diannanguyiwen.ttf';
					
				// 创建一个临时的文本来触发字体加载
				const tempText = this.currentLanguage === 'nushu' ? '𛉋𛅺𛇯𛅻' : this.currentLanguage === 'hannom' ? '測試' : this.currentLanguage === 'yiwen' ? '嶷文' : '彝文';
				
				// 强制更新字体
				this.currentFont = this.currentLanguage === 'nushu' ? 'Nushu' : this.currentLanguage === 'hannom' ? 'Hannom' : this.currentLanguage === 'yiwen' ? 'Yiwen' : 'Diannanguyiwen';
				
				setTimeout(() => {
				}, 2000);
			},
			handleScroll(e) {
				// 使用节流处理滚动事件
				if (this.scrollThrottling) return;
				this.scrollThrottling = true;
				
				setTimeout(() => {
					const scrollTop = e.detail.scrollTop;
					this.scrollTop = scrollTop;
					
					// 简化返回顶部按钮的显示逻辑
					this.showBackToTop = this.isSmallScreen ? (scrollTop > 150) : (scrollTop > 300);
					
					this.scrollThrottling = false;
				}, 16); // 约60fps
			},
			updateScrollState(scrollTop) {
				// 控制顶部指示器显示
				if (scrollTop > 50 && !this.scrolled) {
					this.scrolled = true;
				} else if (scrollTop <= 50 && this.scrolled) {
					this.scrolled = false;
				}
				
				// 滚动时动态加载/显示元素
				this.checkVisibleElements();
			},
			checkVisibleElements() {
				// 这个方法在实际应用中会检测元素是否进入视口
				// 由于小程序环境限制，这里使用简化的实现
				const offset = this.scrollTop + uni.getSystemInfoSync().windowHeight;
				
				// 动态添加元素的显示类
				this.animatedItems.forEach(item => {
					if (!item.animated && offset > item.offsetTop) {
						// 标记元素已动画
						item.animated = true;
						// 添加动画类
					}
				});
			},
			scrollToTop() {
				uni.pageScrollTo({
					scrollTop: 0,
					duration: 0 // 立即滚动，不使用动画
				});
			},
			// 针对小屏幕设备的特殊处理
			adjustForSmallScreen() {
				// 减少首页展示的推荐项数量
				if (this.articles.length > 2) {
					this.articles = this.articles.slice(0, 2);
				}
				
				// 调整单词卡片高度
				const wordSwiper = document.querySelector('.ios-word-swiper');
				if (wordSwiper) {
					wordSwiper.style.height = '30vh'; // 减小单词卡片高度
				}
			},
			handleScrollToLower() {
				if (this.pullLoading || !this.hasMoreData) return;
				
				this.isPulling = true;
				this.pullLoading = true;
				
				// 使用 setTimeout 替代 requestAnimationFrame
				setTimeout(() => {
					setTimeout(() => {
						this.hasMoreData = false;
						this.isPulling = false;
						this.pullLoading = false;
					}, 1200);
				}, 16);
			},
			// 处理弹性上拉效果
			onTouchStart(e) {
				// 只记录初始触摸位置
				this.touchStartY = e.touches[0].clientY;
				this.initialScrollTop = this.scrollTop;
				this.elasticPulling = false;
				this.elasticHeight = 0;
				this.isElasticAnimating = false;
			},
			
			onTouchMove(e) {
				// 记录当前触摸位置
				this.touchMoveY = e.touches[0].clientY;
				
				// 计算拖动距离
				const deltaY = this.touchStartY - this.touchMoveY;
				
				// 仅在滚动到底部并且是上拉操作时应用弹性效果
				if (this.scrolledToBottom && deltaY > 0) {
					const damping = 0.3;
					this.elasticHeight = Math.min(
						this.maxOverScroll, 
						Math.pow(deltaY * damping, 0.8)
					);
					this.elasticPulling = true;
				}
			},
			
			onTouchEnd() {
				if (this.elasticPulling) {
					// 设置回弹动画
					this.isElasticAnimating = true;
					
					// 如果拉伸足够，触发加载
					if (this.elasticHeight > 60) {
						// 保持一段时间的拉伸效果，然后回弹
						setTimeout(() => {
							this.handleScrollToLower();
							this.elasticSnapBack();
						}, 200);
					} else {
						// 立即回弹
						this.elasticSnapBack();
					}
				}
			},
			
			// 回弹动画
			elasticSnapBack() {
				// 模拟弹性回弹动画
				const frames = 20; // 动画帧数
				const duration = 300; // 总持续时间（毫秒）
				const frameTime = duration / frames;
				const startHeight = this.elasticHeight;
				let currentFrame = 0;
				
				const animateBack = () => {
					currentFrame++;
					// 使用easeOutElastic缓动函数
					const progress = this.easeOutElastic(currentFrame / frames);
					this.elasticHeight = startHeight * (1 - progress);
					
					if (currentFrame < frames) {
						setTimeout(animateBack, frameTime);
					} else {
						this.elasticHeight = 0;
						this.elasticPulling = false;
						this.isElasticAnimating = false;
					}
				};
				
				animateBack();
			},
			
			// 弹性缓动函数
			easeOutElastic(t) {
				const p = 0.3;
				return Math.pow(2, -10 * t) * Math.sin((t - p / 4) * (2 * Math.PI) / p) + 1;
			},
			// 新增：滚动时减少动画效果
			reduceAnimationsWhileScrolling() {
				// 滚动时临时暂停弹幕动画更新
				this.pauseDanmakuCreation = true;
			},
			// 新增：恢复动画效果
			restoreAnimations() {
				// 滚动结束后恢复弹幕创建
				this.pauseDanmakuCreation = false;
			},
			// 新增性能优化初始化方法
			initPerformanceOptimizations() {
				// 根据设备性能调整动画和效果
				if (this.useReducedMotion) {
					// 减少弹幕数量
					this.danmakuTexts = this.danmakuTexts.slice(0, 10);
					
					// 设置CSS变量以减少动画效果
					document.documentElement.style.setProperty('--reduced-motion', 'true');
				}
			},
			// 修改模拟 requestAnimationFrame 的工具方法
			simulateRAF(callback) {
				return setTimeout(() => {
					callback();
				}, 16); // 约60fps
			},
			// 清理方法保持不变
			clearSimulateRAF(id) {
				clearTimeout(id);
			},
			
			// 查看全部文章
			viewAllArticles() {
				uni.navigateTo({
					url: '/pages/read/index',
					fail: (err) => {
						console.error("跳转文章列表页面失败:", err);
						uni.showToast({
							title: '页面跳转失败',
							icon: 'none'
						});
					}
				});
			},
			
			// 跳转到文章阅读页面
			goToReadPage() {
				uni.navigateTo({
					url: '/pages/read/index',
					fail: (err) => {
						console.error("跳转文章列表页面失败:", err);
						uni.showToast({
							title: '页面跳转失败',
							icon: 'none'
						});
					}
				});
			},
			
			// 跳转到语言选择页面
			goToLanguagePage() {
				uni.navigateTo({
					url: '/pages/index/language',
					events: {
						languageChanged: (language) => {
							this.handleLanguageChange(language);
						}
					}
				});
			},
			
			// 更新词汇URL
			updateVocabUrl() {
				this.vocabUrl = this.currentLanguage === 'nushu'
					? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/女书词汇音频文件/nvshuword.json'
					: this.currentLanguage === 'hannom'
					? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/汉喃字越南语学习/汉喃词条大全/Hannom.json'
					: this.currentLanguage === 'yiwen'
					? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/嶷文-宁远平话/宁远平话词典单词卡片/ningyuanxilupinghuahuajianwen.json'
					: this.currentLanguage === 'mongolian'
					? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/蒙古文-蒙古语/蒙古文单词卡/mengguword.json'
					: this.currentLanguage === 'manchu'
					? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/满文_满族语言/满语单词卡/manchu_words.json'
					: 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/彝文-滇南古彝文/彝文单词卡/yiwen word.json';
			},
			
			goToWordDetail(word) {
				if (this.currentLanguage === 'nushu') {
					// 传递完整的数据对象
					uni.navigateTo({
						url: `/pages/index/wordDetail?word=${encodeURIComponent(word.word)}&data=${encodeURIComponent(JSON.stringify(word.fullData))}`
					});
				} else {
					uni.navigateTo({
						url: `/pages/index/wordDetail?word=${encodeURIComponent(word.word)}`
					});
				}
			},
			async fetchArticles() {
				this.isLoading = true;
				try {
					const url = this.currentLanguage === 'nushu'
						? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/女书文献文章集合/女书文章/articles.json'
						: this.currentLanguage === 'hannom'
						? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/汉喃字越南语学习/汉喃文章文献/汉喃文章/hannom articles.json'
						: this.currentLanguage === 'yiwen'
						? 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/女书文献文章集合/女书文章/articles.json'
						: 'https://mp-5f8886e4-4529-4ac6-8f2e-10ea93c64b69.cdn.bspapp.com/女书文献文章集合/女书文章/articles.json';
						
					const [err, res] = await uni.request({
						url: url,
						method: 'GET'
					});
					
					if (err) {
						throw new Error('获取文章列表失败');
					}
					
					if (res.statusCode === 200 && res.data && res.data.articles) {
						this.articles = res.data.articles;
					} else {
						throw new Error('文章数据格式错误');
					}
				} catch (error) {
					uni.showToast({
						title: '获取文章列表失败',
						icon: 'none'
					});
				} finally {
					this.isLoading = false;
				}
			},
			// 跳转到文章详情页
			goToArticle(articleId) {
				uni.navigateTo({
					url: `/pages/read/detail?id=${articleId}`,
					fail: (err) => {
						console.error("跳转文章阅读页面失败:", err);
						uni.showToast({
							title: '页面跳转失败',
							icon: 'none'
						});
					}
				});
			},
			handleSearch() {
				// 处理搜索逻辑
			},
			
			clearSearch() {
				this.searchText = '';
			},
			
			selectCategory(categoryId) {
				this.selectedCategory = categoryId;
			},
			
			getCategoryName(categoryId) {
				const category = this.categories.find(item => item.id === categoryId);
				return category ? category.name : '';
			},
			
			// 修改加载失败时的备用数据
			loadFallbackData() {
				this.displayWords = [{
					word: '加载失败',
					pinyin: '请检查网络连接',
					meaning: '无法获取数据',
					audio: ''
				}];
				this.allWords = [];
				this.currentPage = 0;
			},
			
			// 新增：滚动时减少动画效果
			reduceAnimationsWhileScrolling() {
				// 滚动时临时暂停弹幕动画更新
				this.pauseDanmakuCreation = true;
			},
			// 新增：恢复动画效果
			restoreAnimations() {
				// 滚动结束后恢复弹幕创建
				this.pauseDanmakuCreation = false;
			},
			// 新增性能优化初始化方法
			initPerformanceOptimizations() {
				// 根据设备性能调整动画和效果
				if (this.useReducedMotion) {
					// 减少弹幕数量
					this.danmakuTexts = this.danmakuTexts.slice(0, 10);
					
					// 设置CSS变量以减少动画效果
					document.documentElement.style.setProperty('--reduced-motion', 'true');
				}
			},
			// 修改模拟 requestAnimationFrame 的工具方法
			simulateRAF(callback) {
				return setTimeout(() => {
					callback();
				}, 16); // 约60fps
			},
			// 清理方法保持不变
			clearSimulateRAF(id) {
				clearTimeout(id);
			},
			// 添加语言变化处理方法
			handleLanguageChange(language) {
				console.log('Language changed to:', language);
				if (language && language !== this.currentLanguage) {
					// 更新当前语言
					this.currentLanguage = language;
					// 保存到本地存储
					uni.setStorageSync('currentLanguage', language);
					
					// 重置所有相关数据
					this.displayWords = [];
					this.allWords = [];
					this.currentPage = 0;
					this.currentWordIndex = 0;
					
					// 更新词汇URL
					this.updateVocabUrl();
					
					// 重新获取数据
					this.fetchVocabData();
					
					// 重新获取文章数据
					this.fetchArticles();
					
					// 预加载字体
					this.preloadFont();
				}
			},
			
			truncateText(text) {
				if (!text) return '';
				if (this.currentLanguage === 'mongolian' || this.currentLanguage === 'manchu') {
					return text.length > 20 ? text.slice(0, 20) + '...' : text;
				}
				return text;
			},
		}
	}
</script>

<style lang="scss">
.page-container {
	flex: 1;
	background-color: #FFFFFF;
	position: relative;
	height: 100vh;
	will-change: transform;
	transform: translateZ(0);
}

.ios-background {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 1;
	background-color: #FFFFFF;
}

.ios-gradient-bg {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 300rpx;
	background: #FFFFFF;
	z-index: 1;
}

.ios-status-bar {
	height: var(--status-bar-height);
	width: 100%;
}

.ios-scroll-container {
	flex: 1;
	height: calc(100vh - var(--status-bar-height));
	position: relative;
	z-index: 10;
	-webkit-overflow-scrolling: touch;
	will-change: transform;
	transform: translateZ(0);
	background-color: #FFFFFF;
}

.ios-nav-header {
	padding: 10rpx 32rpx;
	display: flex;
	justify-content: space-between;
	align-items: center;
	height: 60rpx;
	animation: slideInDown 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	opacity: 0;
	transform: translateZ(0);
}

.ios-header-left {
	width: 60rpx;
	height: 60rpx;
	display: flex;
	align-items: center;
	justify-content: center;
}

.ios-header-right {
	display: flex;
	align-items: center;
	gap: 20rpx;
}

.ios-icon-button {
	width: 60rpx;
	height: 60rpx;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 30rpx;
}

.ios-icon {
	font-size: 40rpx;
	color: #1a3263;
}

.ios-word-swiper {
	height: 620rpx;
	width: 100%;
	margin-top: 0;
	margin-bottom: 6rpx;
	animation: fadeIn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	animation-delay: 0.1s;
	opacity: 0;
	transform: translateZ(0);
	padding: 10rpx 0;
	will-change: transform;
	backface-visibility: hidden;
}

.ios-card {
	margin: 0 10rpx;
	background-color: #FFFFFF;
	border-radius: 20rpx;
	box-shadow: 0 8rpx 20rpx rgba(26, 50, 99, 0.15);
	padding: 30rpx;
	height: auto;
	display: flex;
	flex-direction: column;
	position: relative;
	transition: transform 0.2s ease;
	will-change: transform;
	transform: translateZ(0);
	opacity: 0;
	animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	animation-delay: 0.2s;
	cursor: pointer;
	overflow: hidden;
}

.ios-card:active {
	transform: scale(0.98) translateZ(0);
	background-color: rgba(26, 50, 99, 0.02);
}

.ios-loading-card {
	display: flex;
	align-items: center;
	justify-content: center;
	flex-direction: column;
}

.ios-loading-indicator {
	width: 40rpx;
	height: 40rpx;
	border-radius: 20rpx;
	border: 4rpx solid rgba(26, 50, 99, 0.2);
	border-top-color: #1a3263;
	animation: ios-spin 1s infinite linear;
}

@keyframes ios-spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.ios-loading-text {
	margin-top: 20rpx;
	font-size: 28rpx;
	color: #1a3263;
}

.ios-card-content {
	flex: 1;
	display: flex;
	flex-direction: column;
	gap: 8rpx;
	overflow: hidden;
}

.ios-card-header {
	display: flex;
	justify-content: flex-start;
	margin-bottom: 16rpx;
	min-height: 100rpx;
}

.ios-word-character {
	font-family: 'Diannanguyiwen', 'Yiwen', 'Nushu', 'Hannom', sans-serif;
	font-size: 90rpx;
	font-weight: 600;
	color: #1a3263;
	line-height: 1.3;
	text-align: left;
	word-break: keep-all;
	white-space: pre-line;
	overflow-wrap: break-word;
	line-break: strict;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

.ios-word-pinyin-box {
	margin-bottom: 4rpx;
	background: rgba(26,50,99,0.03);
	border-radius: 10rpx;
	padding: 6rpx 10rpx;
	max-height: 80rpx;
	overflow: hidden;
}

.ios-word-pinyin {
	font-size: 28rpx;
	color: #3a5a8c;
	margin-bottom: 16rpx;
	display: -webkit-box;
	-webkit-box-orient: vertical;
	overflow: hidden;
	text-overflow: ellipsis;
	word-break: break-all;
	white-space: pre-line;
}

.ios-word-meaning-box {
	background: rgba(26,50,99,0.06);
	border-radius: 10rpx;
	padding: 16rpx 20rpx;
	max-height: 340rpx;
	overflow: hidden;
}

.ios-word-meaning {
	font-size: 32rpx;
	color: #1a3263;
	line-height: 1.8;
	text-align: left;
	display: -webkit-box;
	-webkit-box-orient: vertical;
	overflow: hidden;
	text-overflow: ellipsis;
	word-break: break-word;
	white-space: pre-line;
}

.ios-word-meaning-box::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 60rpx;
	background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.9) 100%);
	pointer-events: none;
}

.ios-word-long {
	font-size: 72rpx;
	line-height: 1.2;
}

.ios-word-very-long {
	font-size: 60rpx;
	line-height: 1.1;
}

.ios-expand-btn {
	position: absolute;
	bottom: 20rpx;
	right: 20rpx;
	padding: 8rpx 16rpx;
	background: rgba(26, 50, 99, 0.1);
	border-radius: 20rpx;
	font-size: 24rpx;
	color: #1a3263;
	z-index: 2;
}

.ios-expand-btn:active {
	background: rgba(26, 50, 99, 0.2);
}

.ios-audio-button {
	position: absolute;
	top: 28rpx;
	right: 28rpx;
	width: 70rpx;
	height: 70rpx;
	border-radius: 35rpx;
	background-color: #1a3263;
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: 0 4rpx 12rpx rgba(26, 50, 99, 0.3);
	transition: transform 0.2s ease;
	z-index: 10;
	transform: translateZ(0);
}

.ios-audio-button:active {
	transform: scale(0.9);
}

.ios-audio-icon {
	width: 32rpx;
	height: 32rpx;
	background-image: url('../../static/icon/sound-svgrepo-com.svg');
	background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
	transform: translateZ(0);
	transition: transform 0.3s ease;
}

.ios-audio-playing {
	animation: audio-rotate 2s infinite linear;
}

@keyframes audio-rotate {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.ios-menu-section, .ios-list-section {
	margin: 0 32rpx;
	margin-top: 0;
	background-color: #FFFFFF;
}

.ios-section-header {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	margin-bottom: 24rpx;
}

.ios-section-title {
	font-size: 36rpx;
	font-weight: 600;
	color: #1a3263;
}

.ios-section-action {
	font-size: 28rpx;
	color: #1a3263;
	font-weight: 500;
}

.ios-grid {
	display: flex;
	flex-wrap: wrap;
	margin: 0 -12rpx;
	will-change: transform;
	transform: translateZ(0);
	animation: fadeIn 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	animation-delay: 0.3s;
	opacity: 0;
}

.ios-grid-item {
	width: 25%;
	padding: 16rpx;
	display: flex;
	flex-direction: column;
	align-items: center;
	animation: fadeInUp 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	opacity: 0;
	animation-delay: calc(0.3s + var(--index, 0) * 0.05s);
	transform: translateZ(0);
	position: relative;
}

.ios-grid-item:active .ios-grid-icon-container {
	transform: scale(0.92);
	box-shadow: 0 2rpx 5rpx rgba(26, 50, 99, 0.1);
}

.ios-grid-icon-container {
	width: 130rpx;
	height: 130rpx;
	border-radius: 30rpx;
	background-color: #FFFFFF;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-bottom: 16rpx;
	box-shadow: 0 4rpx 12rpx rgba(26, 50, 99, 0.15);
	transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.ios-grid-icon {
	width: 65rpx;
	height: 65rpx;
	/* filter: invert(15%) sepia(30%) saturate(1200%) hue-rotate(200deg) brightness(90%) contrast(95%); */
	will-change: transform;
	transform: translateZ(0);
	backface-visibility: hidden;
}

.ios-grid-label {
	font-size: 28rpx;
	color: #1a3263;
	text-align: center;
	font-weight: 500;
	margin-top: 4rpx;
}

.ios-list {
	background-color: #FFFFFF;
	border-radius: 16rpx;
	overflow: hidden;
	box-shadow: 0 2rpx 10rpx rgba(26, 50, 99, 0.1);
	animation: fadeIn 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	animation-delay: 0.4s;
	opacity: 0;
	transform: translateZ(0);
}

.ios-list-item {
	padding: 24rpx;
	display: flex;
	align-items: center;
	border-bottom: 1rpx solid #E5E5EA;
	animation: fadeInUp 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	opacity: 0;
	animation-delay: calc(0.4s + var(--index, 0) * 0.05s);
	transform: translateZ(0);
	will-change: transform;
}

.ios-list-item:last-child {
	border-bottom: none;
}

.ios-list-icon {
	width: 80rpx;
	height: 80rpx;
	border-radius: 16rpx;
	background-color: rgba(26, 50, 99, 0.05);
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 20rpx;
}

.ios-list-icon image {
	width: 40rpx;
	height: 40rpx;
	/* filter: invert(15%) sepia(30%) saturate(1200%) hue-rotate(200deg) brightness(90%) contrast(95%); */
	will-change: transform;
	transform: translateZ(0);
	backface-visibility: hidden;
}

.ios-list-content {
	flex: 1;
}

.ios-list-title {
	font-size: 32rpx;
	font-weight: 500;
	color: #1a3263;
	margin-bottom: 4rpx;
}

.ios-list-subtitle {
	font-size: 26rpx;
	color: #4a6fa5;
}

.ios-chevron {
	width: 30rpx;
	height: 30rpx;
	position: relative;
}

.ios-chevron:after {
	content: '';
	position: absolute;
	width: 16rpx;
	height: 16rpx;
	border-top: 2rpx solid #1a3263;
	border-right: 2rpx solid #1a3263;
	transform: rotate(45deg);
	top: 7rpx;
	left: 0;
}

.ios-load-more, .ios-no-more-data {
	padding: 32rpx;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
}

.ios-loading-dots {
	display: flex;
	margin-bottom: 12rpx;
}

.ios-loading-dot {
	width: 12rpx;
	height: 12rpx;
	border-radius: 6rpx;
	background-color: #4a6fa5;
	margin: 0 4rpx;
	animation: dot-pulse 1.5s infinite ease-in-out;
}

.ios-loading-dot:nth-child(2) {
	animation-delay: 0.2s;
}

.ios-loading-dot:nth-child(3) {
	animation-delay: 0.4s;
}

@keyframes dot-pulse {
	0%, 80%, 100% { transform: scale(0.8); opacity: 0.6; }
	40% { transform: scale(1.2); opacity: 1; }
}

.ios-load-text, .ios-no-more-data text {
	font-size: 26rpx;
	color: #4a6fa5;
}

.ios-safe-area-bottom {
	height: 34rpx;
}

.ios-back-to-top {
	position: fixed;
	bottom: 80rpx;
	right: 30rpx;
	width: 80rpx;
	height: 80rpx;
	border-radius: 40rpx;
	background-color: rgba(26, 50, 99, 0.8);
	box-shadow: 0 4rpx 16rpx rgba(26, 50, 99, 0.2);
	display: flex;
	align-items: center;
	justify-content: center;
	opacity: 0;
	transform: translateY(30rpx);
	transition: opacity 0.3s, transform 0.3s;
	z-index: 100;
	will-change: transform, opacity;
}

.ios-back-to-top-icon {
	width: 30rpx;
	height: 30rpx;
	position: relative;
}

.ios-back-to-top-icon:after {
	content: '';
	position: absolute;
	width: 20rpx;
	height: 20rpx;
	border-top: 3rpx solid #FFFFFF;
	border-left: 3rpx solid #FFFFFF;
	transform: rotate(45deg);
	top: 10rpx;
	left: 5rpx;
}

.ios-visible {
	opacity: 1;
	transform: translateY(0);
}

@keyframes fadeIn {
	from {
		opacity: 0;
	}
	to {
		opacity: 1;
	}
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(10px) translateZ(0);
	}
	to {
		opacity: 1;
		transform: translateY(0) translateZ(0);
	}
}

@keyframes slideInDown {
	from {
		opacity: 0;
		transform: translateY(-20px) translateZ(0);
	}
	to {
		opacity: 1;
		transform: translateY(0) translateZ(0);
	}
}

.ios-card {
	animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
	animation-delay: 0.2s;
	opacity: 0;
	transform: translateZ(0);
	transition: transform 0.15s ease;
}

.ios-card:active {
	animation: none;
	transform: scale(0.98) translateZ(0);
}

.swiper-item {
	display: flex;
	justify-content: center;
	align-items: center;
	transition: all 0.3s ease;
}

.swiper-item-active {
	transform: scale(1);
}

.ios-card-active {
	transform: translateZ(0) scale(1);
	box-shadow: 0 12rpx 28rpx rgba(26, 50, 99, 0.2);
	z-index: 2;
}

.uni-swiper-wrapper .uni-swiper-slide {
	transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
	transform: scale(0.85);
}

.uni-swiper-wrapper .uni-swiper-slide-active {
	transform: scale(1);
	z-index: 2;
}

.ios-audio-button {
	position: absolute;
	top: 28rpx;
	right: 28rpx;
	width: 70rpx;
	height: 70rpx;
	border-radius: 35rpx;
	background-color: #1a3263;
	display: flex;
	align-items: center;
	justify-content: center;
	box-shadow: 0 4rpx 12rpx rgba(26, 50, 99, 0.3);
	transition: transform 0.2s ease;
	z-index: 10;
}

.ios-audio-button:active {
	transform: scale(0.9);
}

.ios-audio-icon {
	width: 32rpx;
	height: 32rpx;
	background-image: url('../../static/icon/sound-svgrepo-com.svg');
	background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
	transform: translateZ(0);
	transition: transform 0.3s ease;
}

.ios-audio-playing {
	animation: audio-rotate 2s infinite linear;
}

@keyframes audio-rotate {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.ios-language-button {
	width: 60rpx;
	height: 60rpx;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 30rpx;
	background-color: rgba(26, 50, 99, 0.05);
	transition: background-color 0.2s ease;
}

.ios-language-button:active {
	background-color: rgba(26, 50, 99, 0.1);
}

.ios-language-button image {
	width: 36rpx;
	height: 36rpx;
	filter: none !important;
}

.detail-btn-container {
	display: flex;
	justify-content: flex-start;
	margin: 16rpx 0 0 0;
}

.detail-btn {
	padding: 16rpx 48rpx;
	background: linear-gradient(135deg, #1a3263, #2a4a8c);
	color: #fff;
	border-radius: 32rpx;
	box-shadow: 0 4rpx 12rpx rgba(26, 50, 99, 0.2);
	transition: all 0.3s ease;
}

.detail-btn:active {
	transform: scale(0.95);
	background: linear-gradient(135deg, #2a4a8c, #1a3263);
	box-shadow: 0 2rpx 6rpx rgba(26, 50, 99, 0.15);
}

.detail-text {
	font-size: 32rpx;
	color: #fff;
	font-weight: 600;
	letter-spacing: 1rpx;
}

.article-section {
	margin: 32rpx;
	margin-bottom: 48rpx;
	background-color: #FFFFFF;
}

.section-header {
	display: flex;
	justify-content: flex-start;
	align-items: center;
	margin-bottom: 24rpx;
}

.section-title {
	font-size: 36rpx;
	font-weight: 600;
	color: #1a3263;
	letter-spacing: 1rpx;
}

.more-link {
	display: flex;
	align-items: center;
	padding: 12rpx 0;
}

.more-link text {
	font-size: 28rpx;
	color: #1a3263;
	opacity: 0.8;
}

.arrow-icon {
	width: 24rpx;
	height: 24rpx;
	position: relative;
	margin-left: 8rpx;
}

.arrow-icon::after {
	content: '';
	position: absolute;
	width: 12rpx;
	height: 12rpx;
	border-top: 2rpx solid #1a3263;
	border-right: 2rpx solid #1a3263;
	transform: rotate(45deg);
	top: 6rpx;
	left: 0;
	opacity: 0.8;
}

.article-list {
	margin-top: 16rpx;
}

.article-item {
	display: flex;
	align-items: flex-start;
	padding: 24rpx 0;
	border-bottom: 1rpx solid rgba(26, 50, 99, 0.08);
}

.article-item:last-child {
	border-bottom: none;
}

.article-avatar {
	width: 80rpx;
	height: 80rpx;
	border-radius: 16rpx;
	background: #1a3263;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 24rpx;
}

.article-avatar text {
	color: #FFFFFF;
	font-size: 32rpx;
	font-weight: 500;
}

.article-content {
	flex: 1;
}

.article-title {
	font-size: 32rpx;
	font-weight: 600;
	color: #1a3263;
	margin-bottom: 8rpx;
	line-height: 1.4;
}

.article-description {
	font-size: 26rpx;
	color: #3A3A3C;
	line-height: 1.5;
	opacity: 0.8;
}

.loading-state {
	display: flex;
	flex-direction: column;
	align-items: center;
	padding: 40rpx 0;
}

.loading-spinner {
	width: 40rpx;
	height: 40rpx;
	border: 3rpx solid rgba(26, 50, 99, 0.1);
	border-top-color: #1a3263;
	border-radius: 50%;
	animation: spin 1s infinite linear;
	margin-bottom: 16rpx;
}

@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.loading-state text {
	font-size: 26rpx;
	color: #1a3263;
	opacity: 0.6;
}

.search-bar {
	margin-bottom: 32rpx;
}

.search-input {
	height: 88rpx;
	background-color: rgba(26, 50, 99, 0.05);
	border-radius: 16rpx;
	display: flex;
	align-items: center;
	padding: 0 28rpx;
	transition: all 0.3s;
}

.search-input:active {
	background-color: rgba(26, 50, 99, 0.08);
}

.search-icon {
	width: 56rpx;
	height: 56rpx;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 20rpx;
	opacity: 0.7;
}

.search-icon image {
	width: 100%;
	height: 100%;
}

.search-input input {
	flex: 1;
	height: 88rpx;
	font-size: 32rpx;
	color: #1a3263;
}

.search-clear {
	width: 40rpx;
	height: 40rpx;
	background-color: rgba(142, 142, 147, 0.3);
	border-radius: 20rpx;
	position: relative;
	transition: all 0.2s;
}

.search-clear:active {
	transform: scale(0.9);
	background-color: rgba(142, 142, 147, 0.5);
}

.search-clear::before, .search-clear::after {
	content: '';
	position: absolute;
	width: 24rpx;
	height: 2rpx;
	background-color: #FFFFFF;
	top: 50%;
	left: 50%;
}

.search-clear::before {
	transform: translate(-50%, -50%) rotate(45deg);
}

.search-clear::after {
	transform: translate(-50%, -50%) rotate(-45deg);
}

.no-results {
	display: flex;
	flex-direction: column;
	align-items: center;
	padding: 100rpx 0;
}

.no-results-icon {
	width: 120rpx;
	height: 120rpx;
	margin-bottom: 24rpx;
	opacity: 0.4;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 100rpx;
	color: #1a3263;
}

.no-results-icon::before {
	content: "\e60c";
	font-family: "uniicons";
}

.no-results text {
	font-size: 30rpx;
	color: #1a3263;
	opacity: 0.6;
	letter-spacing: 2rpx;
}

.article-footer {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-top: 12rpx;
}

.article-author {
	font-size: 26rpx;
	color: #1a3263;
	font-weight: 500;
	opacity: 0.8;
}

.article-date {
	font-size: 24rpx;
	color: #8E8E93;
}

.vertical-mongolian {
  writing-mode: vertical-lr !important;
  text-orientation: mixed;
  font-family: 'MengguWen', 'Noto Sans Mongolian', 'Mongolian Baiti', sans-serif !important;
  letter-spacing: 2px;
  line-height: 1.2;
  display: block !important;
  margin-left: 0;
  margin-right: auto;
  text-align: left;
  height: auto !important;
  min-height: 0 !important;
  white-space: normal !important;
  overflow: visible !important;
}

/* Add specific styles for Manchu text */
.vertical-mongolian[data-language="manchu"] {
  writing-mode: vertical-lr !important; /* Attempt vertical rendering */
  text-orientation: mixed;
  font-family: 'system-ui', sans-serif !important;
  letter-spacing: normal;
  line-height: 1.5;
  text-align: left;
  white-space: normal;
  overflow: visible;
}

.vertical-mongolian-pinyin {
  writing-mode: vertical-lr !important;
  text-orientation: sideways !important;
  font-family: 'Arial', 'Noto Sans Mongolian', sans-serif !important;
  letter-spacing: 2px !important;
  line-height: 1.2 !important;
  display: block !important;
  width: auto !important;
  min-height: 0 !important;
  white-space: nowrap !important;
  margin: 0 !important;
  padding: 0 1px !important;
  background: none !important;
  border-radius: 0 !important;
  font-size: 16px !important;
  color: #1a3263 !important;
  align-self: flex-start !important;
  overflow: visible !important;
  text-align: center !important;
  max-height: none !important;
}

.vertical-mongolian-chinese {
  display: block;
  width: auto;
  min-height: 80px;
  white-space: normal;
  margin: 0 auto;
  padding: 0 2px;
  box-sizing: border-box;
  background: none;
  border-radius: 0;
  font-size: 18px;
  align-self: flex-end;
}

@font-face {
  font-family: 'MengguWen';
  src: url('/static/fonts/mengguwen.ttf') format('truetype');
  font-display: swap;
  font-weight: normal;
  font-style: normal;
}

.mongolian-card-content {
  display: flex !important;
  flex-direction: row !important;
  align-items: flex-start !important;
  overflow: visible !important;
  height: auto !important;
}

.ios-card-header {
  margin-bottom: 0 !important;
  margin-right: 8px !important;
  height: auto !important;
  min-height: 0 !important;
}
</style>

<style>
@font-face {
	font-family: 'Nushu';
	src: url('/static/fonts/Nushu.ttf') format('truetype');
	font-display: swap;
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Hannom';
	src: url('/static/fonts/NOMNATONG-REGULAR.TTF') format('truetype');
	font-display: swap;
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Yiwen';
	src: url('/static/fonts/Yiwen.ttf') format('truetype');
	font-display: swap;
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Diannanguyiwen';
	src: url('/static/fonts/diannanguyiwen.ttf') format('truetype');
	font-display: swap;
	font-weight: normal;
	font-style: normal;
}
</style>
